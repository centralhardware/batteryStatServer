# Battery Monitor iOS App

iOS приложение для мониторинга состояния батареи и отправки данных на сервер.

## Возможности

- Отображение текущего заряда батареи
- Мониторинг здоровья батареи (health percent)
- Отслеживание циклов зарядки
- Отображение емкости батареи (design/max capacity)
- Мониторинг напряжения и тока
- Автоматическая отправка данных на сервер с настраиваемым интервалом
- Настройка URL сервера

## Требования

- iOS 15.0+
- Xcode 14.0+
- Swift 5.0+

## Установка

1. Откройте `BatteryMonitor.xcodeproj` в Xcode
2. Выберите ваше устройство или симулятор
3. Нажмите Run (⌘R)

## Настройка

1. Откройте приложение
2. Нажмите на иконку настроек (шестеренка) в правом верхнем углу
3. Введите URL вашего сервера (по умолчанию: `http://10.168.0.77:8321`)
4. Нажмите "Test Connection" для проверки соединения
5. Нажмите "Done"

## Использование

1. На главном экране вы увидите текущую информацию о батарее:
   - Уровень заряда
   - Статус зарядки
   - Здоровье батареи
   - Количество циклов
   - Детальная информация (емкость, напряжение, ток, температура)

2. Настройте интервал обновления (10-300 секунд)

3. Нажмите "Start Monitoring" для начала автоматической отправки данных

4. Данные будут автоматически отправляться на сервер с выбранным интервалом

## API

Приложение отправляет POST запросы на `{serverURL}/api/battery/health` со следующей структурой:

```json
{
  "deviceId": "UUID устройства",
  "cycleCount": 123,
  "healthPercent": 95,
  "currentCharge": 80,
  "temperature": 25.0,
  "isCharging": true,
  "designCapacityMah": 3095,
  "maxCapacityMah": 2940,
  "voltageMv": 4200,
  "currentMa": 1000
}
```

## Источники данных

Приложение использует **IOKit framework** для получения реальных данных о батарее напрямую из системы.

### Доступные данные из IOKit:
- `cycleCount` - реальное количество циклов зарядки
- `designCapacity` - дизайн емкость батареи в mAh
- `maxCapacity` - текущая максимальная емкость в mAh
- `currentCapacity` - текущая емкость в mAh
- `voltage` - текущее напряжение в мВ
- `current` - текущий ток в мА (положительный при зарядке, отрицательный при разрядке)
- `temperature` - температура батареи в градусах Цельсия
- `isCharging` - статус зарядки

### Вычисляемые данные:
- `healthPercent` - процент здоровья батареи, вычисляется как `(maxCapacity / designCapacity) * 100`
- `currentCharge` - текущий заряд в процентах (из UIDevice.batteryLevel)

### Недоступные данные:
Если IOKit не может предоставить данные (например, на симуляторе), соответствующие поля будут содержать `0`.

## Структура проекта

```
BatteryMonitor/
├── BatteryMonitor.xcodeproj/
├── BatteryMonitor/
│   ├── BatteryMonitorApp.swift              # Главный файл приложения
│   ├── BatteryMonitor-Bridging-Header.h     # Bridging header для Objective-C
│   ├── Models/
│   │   └── BatteryData.swift                # Модели данных
│   ├── Services/
│   │   ├── BatteryService.swift             # Сервис сбора данных батареи (Swift)
│   │   ├── APIService.swift                 # Сервис API (Swift)
│   │   ├── IOKitBatteryInfo.h               # Заголовок IOKit (Objective-C)
│   │   └── IOKitBatteryInfo.m               # Реализация IOKit (Objective-C)
│   ├── Views/
│   │   ├── ContentView.swift                # Главный экран
│   │   └── SettingsView.swift               # Экран настроек
│   ├── Assets.xcassets/                     # Ресурсы приложения
│   └── Info.plist                           # Конфигурация приложения
```

## Разработка

### Добавление новых полей

1. Обновите модель `BatteryHealthRequest` в `Models/BatteryData.swift`
2. Обновите метод сбора данных в `Services/BatteryService.swift`
3. При необходимости обновите UI в `Views/ContentView.swift`

### Фоновый мониторинг

Для добавления фонового мониторинга потребуется:
1. Настроить Background Modes в Xcode
2. Использовать BGTaskScheduler для периодических задач
3. Учесть ограничения iOS на фоновую активность

## Лицензия

MIT
